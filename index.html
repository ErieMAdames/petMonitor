<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSV Color Adjustment Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .slider-container {
            margin-bottom: 10px;
        }
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>

<h1>HSV Color Range Adjustment</h1>

<canvas id="canvas"></canvas>

<div class="slider-container">
    <label for="lowerHue">Lower Hue: </label><input type="range" id="lowerHue" min="0" max="179" value="10"><span id="lowerHueValue">10</span><br>
    <label for="lowerSaturation">Lower Saturation: </label><input type="range" id="lowerSaturation" min="0" max="255" value="50"><span id="lowerSaturationValue">50</span><br>
    <label for="lowerValue">Lower Value: </label><input type="range" id="lowerValue" min="0" max="255" value="30"><span id="lowerValueValue">30</span><br>
    <label for="upperHue">Upper Hue: </label><input type="range" id="upperHue" min="0" max="179" value="30"><span id="upperHueValue">30</span><br>
    <label for="upperSaturation">Upper Saturation: </label><input type="range" id="upperSaturation" min="0" max="255" value="255"><span id="upperSaturationValue">255</span><br>
    <label for="upperValue">Upper Value: </label><input type="range" id="upperValue" min="0" max="255" value="180"><span id="upperValueValue">180</span><br>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();

    // Load the image (you can replace this with your own image source)
    img.src = 'https://via.placeholder.com/500x500.png?text=Image+to+Process';  // Example image URL

    img.onload = () => {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        updateMask();  // Call to display the initial masked image
    };

    // Update slider values display
    const sliders = ['lowerHue', 'lowerSaturation', 'lowerValue', 'upperHue', 'upperSaturation', 'upperValue'];
    sliders.forEach(sliderId => {
        const slider = document.getElementById(sliderId);
        const valueDisplay = document.getElementById(sliderId + 'Value');
        slider.addEventListener('input', () => {
            valueDisplay.textContent = slider.value;
            updateMask();  // Update the mask when any slider value changes
        });
    });

    function updateMask() {
        // Get current values from sliders
        const lowerHue = parseInt(document.getElementById('lowerHue').value);
        const lowerSaturation = parseInt(document.getElementById('lowerSaturation').value);
        const lowerValue = parseInt(document.getElementById('lowerValue').value);
        const upperHue = parseInt(document.getElementById('upperHue').value);
        const upperSaturation = parseInt(document.getElementById('upperSaturation').value);
        const upperValue = parseInt(document.getElementById('upperValue').value);

        // Create a canvas to work with the image data
        const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imgData.data;

        for (let i = 0; i < data.length; i += 4) {
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];

            // Convert RGB to HSV
            const hsv = rgbToHsv(r, g, b);

            // Check if pixel is within the defined HSV range
            if (isWithinRange(hsv, lowerHue, lowerSaturation, lowerValue, upperHue, upperSaturation, upperValue)) {
                // If it is, keep the pixel color
                data[i] = r;
                data[i + 1] = g;
                data[i + 2] = b;
            } else {
                // Otherwise, make the pixel black (or change to any color of your choice)
                data[i] = 0;
                data[i + 1] = 0;
                data[i + 2] = 0;
            }
        }

        // Update the canvas with the modified image data
        ctx.putImageData(imgData, 0, 0);
    }

    // RGB to HSV conversion
    function rgbToHsv(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        let max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, v = max;
        let d = max - min;
        s = max === 0 ? 0 : d / max;
        if (max === min) {
            h = 0;
        } else {
            switch (max) {
                case r:
                    h = (g - b) / d + (g < b ? 6 : 0);
                    break;
                case g:
                    h = (b - r) / d + 2;
                    break;
                case b:
                    h = (r - g) / d + 4;
                    break;
            }
            h /= 6;
        }
        return { h: h * 360, s: s * 100, v: v * 100 };  // Return HSV in degrees and percentage
    }

    // Check if HSV value is within the defined range
    function isWithinRange(hsv, lowerHue, lowerSaturation, lowerValue, upperHue, upperSaturation, upperValue) {
        return (hsv.h >= lowerHue && hsv.h <= upperHue &&
                hsv.s >= lowerSaturation && hsv.s <= upperSaturation &&
                hsv.v >= lowerValue && hsv.v <= upperValue);
    }
</script>

</body>
</html>
