<html>
<head>
<title>Video Stream</title>
<script>
    let ws;
    let ws_images;

    function initWebSocket() {
        ws = new WebSocket('ws://' + window.location.hostname + ':8765/ws');
        ws_images = new WebSocket('ws://' + window.location.hostname + ':8744/ws');
        ws_images.binaryType = "arraybuffer";
        ws.onopen = () => console.log("WebSocket connection established");
        ws.onclose = () => console.log("WebSocket connection closed");
        ws_images.onopen = () => console.log("WebSocket for Shadow & Habichuela connection established");
        ws_images.onclose = () => console.log("WebSocket for Shadow & Habichuela connection closed");
        const shadowPoopCapture = document.querySelector('.shadow-poop-capture');
        ws_images.onmessage = (event) => {
            console.log(event);
            if (event.data.image instanceof ArrayBuffer) {
                const blob = new Blob([event.data.image], { type: "image/jpeg" });
                const imageUrl = URL.createObjectURL(blob);
                shadowPoopCapture.src = imageUrl;
            }
        };
        setInterval(
            function() {
                ws_images.send(JSON.stringify({ pet: "shadow" }));
            },
            500
        )
    }
    function handleKey(event) {
        const key = event.key.toLowerCase();
        if (['w', 'a', 's', 'd'].includes(key)) {
            ws.send(JSON.stringify({ key: key, action: event.type }));
        }
    }

    window.onload = () => {
        initWebSocket();
        document.addEventListener('keydown', handleKey);
        document.addEventListener('keyup', handleKey);
    };
</script>
<style>
    .main-cam {
        transform: rotate(180deg);
    }
</style>
</head>
<body>
    <div class="main-cam-container">
        <img src="stream.mjpg" class="main-cam"/>
    </div>
    <div>
        <img src="" class="shadow-poop-capture"/>
        <img src="" class="habichuela-poop-capture"/>
    </div>
</body>
</html>